<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI BGM Generator - å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ éŸ³æ¥½ç”Ÿæˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.5/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            min-height: 100vh;
        }

        .container {
            min-height: 100vh;
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.3);
        }

        .header {
            padding: 40px 20px;
            text-align: center;
            background: rgba(0, 0, 0, 0.4);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .title {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 300;
        }

        .content {
            padding: 0 20px;
            max-width: 700px;
            margin: 0 auto;
        }

        .ai-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ai-title {
            font-size: 20px;
            font-weight: 700;
            color: #4ecdc4;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .ai-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .ai-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .ai-button.creative {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }

        .ai-button.creative:hover {
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }

        .play-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: #fff;
            border: none;
            padding: 20px 40px;
            border-radius: 50px;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .play-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        .play-button.active {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 15px;
            text-align: center;
        }

        .info-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .info-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }

        .info-value {
            color: #fff;
            font-size: 14px;
            font-weight: 600;
        }

        .info-value.playing {
            color: #4ecdc4;
        }

        .info-value.stopped {
            color: #ff6b6b;
        }

        .parameter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .parameter-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .parameter-title {
            font-size: 16px;
            font-weight: 600;
            color: #4ecdc4;
            margin-bottom: 10px;
        }

        .parameter-value {
            font-size: 20px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 5px;
        }

        .parameter-description {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .error-message {
            background: rgba(244, 67, 54, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .creativity-slider {
            margin: 20px 0;
        }

        .slider {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
            transition: all 0.3s;
        }

        .slider:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(78, 205, 196, 0.5);
        }

        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 10px rgba(78, 205, 196, 0.5);
        }

        .ai-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .ai-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4ecdc4;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .generating {
            background: #ff6b6b;
            animation: pulse 0.5s infinite;
        }

        @media (max-width: 600px) {
            .ai-controls {
                grid-template-columns: 1fr;
            }
            
            .parameter-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const AIBGMGenerator = () => {
            const [isPlaying, setIsPlaying] = useState(false);
            const [isGenerating, setIsGenerating] = useState(false);
            const [currentParameters, setCurrentParameters] = useState({
                genre: 'AIç”Ÿæˆä¸­...',
                mood: 'AIç”Ÿæˆä¸­...',
                tempo: 120,
                key: 'C',
                scale: 'major',
                complexity: 0.5,
                harmony: 0.7,
                rhythm: 0.6,
                melody: 0.8
            });
            const [creativityLevel, setCreativityLevel] = useState(0.7);
            const [synth, setSynth] = useState(null);
            const [bassSynth, setBassSynth] = useState(null);
            const [drumSynth, setDrumSynth] = useState(null);
            const [sequences, setSequences] = useState([]);
            const [error, setError] = useState('');
            const [isInitialized, setIsInitialized] = useState(false);
            const [aiStatus, setAiStatus] = useState('standby');

            // AIéŸ³æ¥½ç”Ÿæˆã‚¯ãƒ©ã‚¹
            class AIComposer {
                constructor() {
                    this.creativityLevel = 0.7;
                    this.musicalKnowledge = {
                        keys: ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'],
                        scales: {
                            major: [0, 2, 4, 5, 7, 9, 11],
                            minor: [0, 2, 3, 5, 7, 8, 10],
                            dorian: [0, 2, 3, 5, 7, 9, 10],
                            mixolydian: [0, 2, 4, 5, 7, 9, 10],
                            pentatonic: [0, 2, 4, 7, 9],
                            blues: [0, 3, 5, 6, 7, 10],
                            harmonic_minor: [0, 2, 3, 5, 7, 8, 11],
                            phrygian: [0, 1, 3, 5, 7, 8, 10],
                            lydian: [0, 2, 4, 6, 7, 9, 11],
                            whole_tone: [0, 2, 4, 6, 8, 10]
                        },
                        genres: ['ambient', 'electronic', 'jazz', 'rock', 'classical', 'experimental', 'world', 'cinematic'],
                        moods: ['peaceful', 'energetic', 'mysterious', 'uplifting', 'melancholic', 'dramatic', 'playful', 'intense'],
                        rhythmPatterns: {
                            simple: [[1, 0, 0, 0], [0, 0, 1, 0], [0, 1, 0, 0], [0, 0, 0, 1]],
                            complex: [[1, 0, 1, 0], [0, 1, 0, 1], [1, 0, 0, 1], [0, 1, 1, 0]],
                            syncopated: [[1, 0, 0, 1], [0, 1, 0, 0], [0, 0, 1, 0], [1, 0, 1, 0]],
                            polyrhythmic: [[1, 0, 1, 0, 1], [0, 1, 0, 1, 0], [1, 0, 0, 1, 0], [0, 0, 1, 0, 1]]
                        }
                    };
                }

                setCreativity(level) {
                    this.creativityLevel = Math.max(0, Math.min(1, level));
                }

                // å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ãªéŸ³æ¥½ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç”Ÿæˆ
                generateRandomParameters() {
                    const creativity = this.creativityLevel;
                    
                    // åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
                    const key = this.musicalKnowledge.keys[Math.floor(Math.random() * this.musicalKnowledge.keys.length)];
                    const scaleTypes = Object.keys(this.musicalKnowledge.scales);
                    const scale = scaleTypes[Math.floor(Math.random() * scaleTypes.length)];
                    
                    // å‰µé€ æ€§ãƒ¬ãƒ™ãƒ«ã«åŸºã¥ã„ã¦ãƒ†ãƒ³ãƒç¯„å›²ã‚’èª¿æ•´
                    const tempoRange = creativity > 0.7 ? [60, 180] : [80, 140];
                    const tempo = Math.floor(Math.random() * (tempoRange[1] - tempoRange[0])) + tempoRange[0];
                    
                    // AIçš„ãªã‚¸ãƒ£ãƒ³ãƒ«ã¨ãƒ ãƒ¼ãƒ‰ã®çµ„ã¿åˆã‚ã›
                    const genre = this.musicalKnowledge.genres[Math.floor(Math.random() * this.musicalKnowledge.genres.length)];
                    const mood = this.musicalKnowledge.moods[Math.floor(Math.random() * this.musicalKnowledge.moods.length)];
                    
                    // éŸ³æ¥½ã®è¤‡é›‘ã•ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
                    const complexity = Math.random() * creativity;
                    const harmony = Math.random();
                    const rhythm = Math.random();
                    const melody = Math.random();

                    return {
                        genre,
                        mood,
                        tempo,
                        key,
                        scale,
                        complexity,
                        harmony,
                        rhythm,
                        melody
                    };
                }

                // ã‚¹ã‚±ãƒ¼ãƒ«ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
                generateScaleNotes(key, scaleType, octaves = [3, 4, 5]) {
                    const keyIndex = this.musicalKnowledge.keys.indexOf(key);
                    const scaleIntervals = this.musicalKnowledge.scales[scaleType];
                    const notes = [];

                    octaves.forEach(octave => {
                        scaleIntervals.forEach(interval => {
                            const noteIndex = (keyIndex + interval) % 12;
                            const noteName = this.musicalKnowledge.keys[noteIndex];
                            notes.push(noteName + octave);
                        });
                    });

                    return notes;
                }

                // AIãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¼ç”Ÿæˆ
                generateAIMelody(parameters) {
                    const { key, scale, complexity, melody: melodicIntensity } = parameters;
                    const scaleNotes = this.generateScaleNotes(key, scale);
                    const melodyLength = Math.floor(8 + (complexity * 16)); // 8-24éŸ³ç¬¦
                    const melody = [];

                    // ãƒãƒ«ã‚³ãƒ•é€£é–é¢¨ã®ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¼ç”Ÿæˆ
                    let currentNoteIndex = Math.floor(Math.random() * scaleNotes.length);
                    
                    for (let i = 0; i < melodyLength; i++) {
                        melody.push(scaleNotes[currentNoteIndex]);
                        
                        // æ¬¡ã®éŸ³ç¬¦ã¸ã®ç§»è¡Œç¢ºç‡ã‚’è¨ˆç®—
                        const stepRange = Math.ceil(complexity * 5) + 1;
                        const direction = Math.random() < 0.5 ? -1 : 1;
                        const stepSize = Math.floor(Math.random() * stepRange) + 1;
                        
                        currentNoteIndex = Math.max(0, Math.min(scaleNotes.length - 1, 
                            currentNoteIndex + (direction * stepSize)));
                        
                        // å‰µé€ æ€§ãŒé«˜ã„å ´åˆã€æ™‚ã€…å¤§ããªè·³èºã‚’è¿½åŠ 
                        if (Math.random() < complexity * 0.3) {
                            currentNoteIndex = Math.floor(Math.random() * scaleNotes.length);
                        }
                    }

                    return melody;
                }

                // AIãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ç”Ÿæˆ
                generateAIHarmony(parameters) {
                    const { key, scale, harmony: harmonicComplexity } = parameters;
                    const scaleNotes = this.generateScaleNotes(key, scale, [2, 3, 4]);
                    const chordProgressions = [];

                    // å’ŒéŸ³é€²è¡Œã®é•·ã•ã‚’å‹•çš„ã«æ±ºå®š
                    const progressionLength = Math.floor(4 + (harmonicComplexity * 8));
                    
                    for (let i = 0; i < progressionLength; i++) {
                        const chordSize = Math.floor(3 + (harmonicComplexity * 3)); // 3-6éŸ³ã®å’ŒéŸ³
                        const chord = [];
                        
                        let rootIndex = Math.floor(Math.random() * scaleNotes.length);
                        
                        for (let j = 0; j < chordSize; j++) {
                            chord.push(scaleNotes[rootIndex]);
                            rootIndex = (rootIndex + 2 + Math.floor(Math.random() * 2)) % scaleNotes.length;
                        }
                        
                        chordProgressions.push(chord);
                    }

                    return chordProgressions;
                }

                // AIãƒªã‚ºãƒ ç”Ÿæˆ
                generateAIRhythm(parameters) {
                    const { complexity, rhythm: rhythmIntensity } = parameters;
                    const patternTypes = Object.keys(this.musicalKnowledge.rhythmPatterns);
                    const selectedPattern = patternTypes[Math.floor(Math.random() * patternTypes.length)];
                    const basePattern = this.musicalKnowledge.rhythmPatterns[selectedPattern];
                    
                    // ãƒªã‚ºãƒ ã®è¤‡é›‘ã•ã«åŸºã¥ã„ã¦ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¤‰æ›´
                    const kick = [];
                    const snare = [];
                    const hihat = [];
                    
                    const patternLength = Math.floor(8 + (complexity * 8));
                    
                    for (let i = 0; i < patternLength; i++) {
                        const beatIndex = i % basePattern.length;
                        const pattern = basePattern[beatIndex];
                        
                        kick.push(pattern[0] && Math.random() < rhythmIntensity ? `0:${Math.floor(i/4)}:${i%4}` : null);
                        snare.push(pattern[1] && Math.random() < rhythmIntensity * 0.7 ? `0:${Math.floor(i/4)}:${i%4}` : null);
                        hihat.push(pattern[2] && Math.random() < rhythmIntensity * 0.9 ? '16n' : null);
                    }

                    return { kick, snare, hihat };
                }

                // å®Œå…¨AIä½œæ›²
                compose(creativityLevel = 0.7) {
                    this.setCreativity(creativityLevel);
                    
                    const parameters = this.generateRandomParameters();
                    const melody = this.generateAIMelody(parameters);
                    const harmony = this.generateAIHarmony(parameters);
                    const rhythm = this.generateAIRhythm(parameters);

                    return {
                        parameters,
                        melody,
                        harmony,
                        rhythm
                    };
                }
            }

            const aiComposer = useRef(new AIComposer());

            // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            const reverb = useRef(null);
            const delay = useRef(null);
            const filter = useRef(null);

            useEffect(() => {
                return () => {
                    stopMusic();
                    if (Tone.context) {
                        Tone.context.dispose();
                    }
                };
            }, []);

            const initializeAudio = async () => {
                try {
                    if (isInitialized) return;

                    if (Tone.context.state !== 'running') {
                        await Tone.start();
                    }

                    // é«˜å“è³ªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®è¨­å®š
                    reverb.current = new Tone.Reverb({
                        decay: 4,
                        preDelay: 0.02,
                        wet: 0.3
                    }).toDestination();

                    delay.current = new Tone.FeedbackDelay({
                        delayTime: "8n",
                        feedback: 0.3,
                        wet: 0.2
                    }).toDestination();

                    filter.current = new Tone.Filter({
                        frequency: 800,
                        type: 'lowpass',
                        rolloff: -24
                    }).toDestination();

                    // é«˜å“è³ªã‚·ãƒ³ã‚»ã‚µã‚¤ã‚¶ãƒ¼
                    const synthInstance = new Tone.PolySynth(Tone.Synth, {
                        oscillator: { 
                            type: 'sawtooth',
                            modulationType: 'sine',
                            modulationIndex: 0.5
                        },
                        envelope: { 
                            attack: 0.1, 
                            decay: 0.2, 
                            sustain: 0.6, 
                            release: 1.2 
                        },
                        filter: {
                            frequency: 1200,
                            type: 'lowpass'
                        }
                    }).connect(reverb.current).connect(delay.current).toDestination();

                    const bassInstance = new Tone.MonoSynth({
                        oscillator: { type: 'square' },
                        envelope: { attack: 0.1, decay: 0.3, sustain: 0.4, release: 0.8 }
                    }).connect(filter.current).toDestination();

                    const drumInstance = new Tone.MembraneSynth({
                        pitchDecay: 0.05,
                        octaves: 10,
                        oscillator: { type: 'sine' },
                        envelope: { attack: 0.001, decay: 0.4, sustain: 0.01, release: 1.4 }
                    }).toDestination();

                    setSynth(synthInstance);
                    setBassSynth(bassInstance);
                    setDrumSynth(drumInstance);

                    // éŸ³é‡ãƒãƒ©ãƒ³ã‚¹èª¿æ•´
                    synthInstance.volume.value = -8;
                    bassInstance.volume.value = -12;
                    drumInstance.volume.value = -18;

                    setIsInitialized(true);
                    setError('');

                } catch (error) {
                    console.error('Audio initialization error:', error);
                    setError('éŸ³å£°ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            };

            const generateAIMusic = async () => {
                setIsGenerating(true);
                setAiStatus('generating');
                
                try {
                    // AIä½œæ›²ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    const composition = aiComposer.current.compose(creativityLevel);
                    setCurrentParameters(composition.parameters);
                    
                    // ç”Ÿæˆã•ã‚ŒãŸéŸ³æ¥½ã‚’ä¿å­˜
                    window.currentComposition = composition;
                    
                    setAiStatus('ready');
                } catch (error) {
                    console.error('AI composition error:', error);
                    setError('AIä½œæ›²ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                    setAiStatus('error');
                } finally {
                    setIsGenerating(false);
                }
            };

            const generateCreativeMusic = async () => {
                setCreativityLevel(0.9);
                await generateAIMusic();
            };

            const startMusic = async () => {
                try {
                    await initializeAudio();

                    if (!synth || !bassSynth || !drumSynth) {
                        throw new Error('éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    }

                    if (!window.currentComposition) {
                        await generateAIMusic();
                    }

                    const composition = window.currentComposition;
                    Tone.Transport.bpm.value = composition.parameters.tempo;

                    // æ—¢å­˜ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ç ´æ£„
                    sequences.forEach(seq => seq.dispose());
                    setSequences([]);

                    // AIãŒç”Ÿæˆã—ãŸãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¼ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
                    const melodySequence = new Tone.Sequence((time, note) => {
                        if (synth && note) {
                            synth.triggerAttackRelease(note, '8n', time);
                        }
                    }, composition.melody, '8n');

                    // AIãŒç”Ÿæˆã—ãŸãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
                    const harmonySequence = new Tone.Sequence((time, chord) => {
                        if (synth && chord) {
                            synth.triggerAttackRelease(chord, '2n', time);
                        }
                    }, composition.harmony, '2n');

                    // AIãŒç”Ÿæˆã—ãŸãƒªã‚ºãƒ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
                    const kickSequence = new Tone.Sequence((time, note) => {
                        if (drumSynth && note) {
                            drumSynth.triggerAttackRelease('C2', '8n', time, 0.8);
                        }
                    }, composition.rhythm.kick, '8n');

                    const snareSequence = new Tone.Sequence((time, note) => {
                        if (drumSynth && note) {
                            drumSynth.triggerAttackRelease('E2', '8n', time, 0.6);
                        }
                    }, composition.rhythm.snare, '8n');

                    const hihatSequence = new Tone.Sequence((time, note) => {
                        if (drumSynth && note) {
                            drumSynth.triggerAttackRelease('G3', '16n', time, 0.3);
                        }
                    }, composition.rhythm.hihat, '16n');

                    // ã‚·ãƒ¼ã‚±ãƒ³ã‚¹é–‹å§‹
                    melodySequence.start(0);
                    harmonySequence.start(0);
                    kickSequence.start(0);
                    snareSequence.start(0);
                    hihatSequence.start(0);

                    setSequences([melodySequence, harmonySequence, kickSequence, snareSequence, hihatSequence]);

                    Tone.Transport.start();
                    setIsPlaying(true);
                    setAiStatus('playing');
                    setError('');

                } catch (error) {
                    console.error('Error starting music:', error);
                    setError('éŸ³æ¥½ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            };

            const stopMusic = () => {
                try {
                    Tone.Transport.stop();
                    Tone.Transport.cancel();

                    sequences.forEach(seq => {
                        if (seq) { seq.dispose(); }
                    });
                    setSequences([]);

                    setIsPlaying(false);
                    setAiStatus('standby');
                } catch (error) {
                    console.error('Error stopping music:', error);
                }
            };

            const togglePlayback = () => {
                if (isPlaying) {
                    stopMusic();
                } else {
                    startMusic();
                }
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1 className="title">ğŸ¤– AI BGM Generator</h1>
                        <p className="subtitle">äººå·¥çŸ¥èƒ½ã«ã‚ˆã‚‹å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ éŸ³æ¥½ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ </p>
                    </div>

                    <div className="content">
                        {error && (
                            <div className="error-message">
                                {error}
                            </div>
                        )}

                        {/* AIåˆ¶å¾¡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                        <div className="ai-section">
                            <h2 className="ai-title">
                                ğŸµ AIä½œæ›²ã‚¨ãƒ³ã‚¸ãƒ³
                                <div className="ai-status">
                                    <div className={`ai-indicator ${isGenerating ? 'generating' : ''}`}></div>
                                    <span>{aiStatus === 'generating' ? 'AIä½œæ›²ä¸­...' : aiStatus === 'ready' ? 'ä½œæ›²å®Œäº†' : aiStatus === 'playing' ? 'å†ç”Ÿä¸­' : 'ã‚¹ã‚¿ãƒ³ãƒã‚¤'}</span>
                                </div>
                            </h2>

                            <div className="creativity-slider">
                                <div className="info-row">
                                    <span className="info-label
                                    ">AIå‰µé€ æ€§ãƒ¬ãƒ™ãƒ«</span>
                                    <span className="info-value">{Math.round(creativityLevel * 100)}%</span>
                                </div>
                                <input
                                    type="range"
                                    min="0.1"
                                    max="1"
                                    step="0.1"
                                    value={creativityLevel}
                                    onChange={(e) => setCreativityLevel(parseFloat(e.target.value))}
                                    className="slider"
                                />
                            </div>

                            <div className="ai-controls">
                                <button
                                    className="ai-button"
                                    onClick={generateAIMusic}
                                    disabled={isGenerating}
                                >
                                    {isGenerating ? 'ğŸ¤– AIä½œæ›²ä¸­...' : 'ğŸ¼ AIä½œæ›²'}
                                </button>
                                <button
                                    className="ai-button creative"
                                    onClick={generateCreativeMusic}
                                    disabled={isGenerating}
                                >
                                    ğŸ¨ å‰µé€ çš„ä½œæ›²
                                </button>
                            </div>

                            <button
                                className={`play-button ${isPlaying ? 'active' : ''}`}
                                onClick={togglePlayback}
                                disabled={isGenerating}
                            >
                                {isPlaying ? 'â¹ï¸ åœæ­¢' : 'â–¶ï¸ å†ç”Ÿ'}
                            </button>
                        </div>

                        {/* ç¾åœ¨ã®éŸ³æ¥½æƒ…å ± */}
                        <div className="section">
                            <h3 className="section-title">ğŸµ ç¾åœ¨ã®éŸ³æ¥½æƒ…å ±</h3>
                            <div className="info-container">
                                <div className="info-row">
                                    <span className="info-label">çŠ¶æ…‹</span>
                                    <span className={`info-value ${isPlaying ? 'playing' : 'stopped'}`}>
                                        {isPlaying ? 'å†ç”Ÿä¸­' : 'åœæ­¢ä¸­'}
                                    </span>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">ã‚¸ãƒ£ãƒ³ãƒ«</span>
                                    <span className="info-value">{currentParameters.genre}</span>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">ãƒ ãƒ¼ãƒ‰</span>
                                    <span className="info-value">{currentParameters.mood}</span>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">ãƒ†ãƒ³ãƒ</span>
                                    <span className="info-value">{currentParameters.tempo} BPM</span>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">ã‚­ãƒ¼</span>
                                    <span className="info-value">{currentParameters.key} {currentParameters.scale}</span>
                                </div>
                            </div>
                        </div>

                        {/* AIéŸ³æ¥½ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ */}
                        <div className="section">
                            <h3 className="section-title">ğŸ§  AIéŸ³æ¥½ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h3>
                            <div className="parameter-grid">
                                <div className="parameter-card">
                                    <div className="parameter-title">è¤‡é›‘ã•</div>
                                    <div className="parameter-value">{Math.round(currentParameters.complexity * 100)}%</div>
                                    <div className="parameter-description">éŸ³æ¥½ã®æ§‹é€ çš„è¤‡é›‘ã•</div>
                                </div>
                                <div className="parameter-card">
                                    <div className="parameter-title">ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼</div>
                                    <div className="parameter-value">{Math.round(currentParameters.harmony * 100)}%</div>
                                    <div className="parameter-description">å’ŒéŸ³ã®è±Šã‹ã•</div>
                                </div>
                                <div className="parameter-card">
                                    <div className="parameter-title">ãƒªã‚ºãƒ </div>
                                    <div className="parameter-value">{Math.round(currentParameters.rhythm * 100)}%</div>
                                    <div className="parameter-description">ãƒªã‚ºãƒ ã®è¤‡é›‘ã•</div>
                                </div>
                                <div className="parameter-card">
                                    <div className="parameter-title">ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¼</div>
                                    <div className="parameter-value">{Math.round(currentParameters.melody * 100)}%</div>
                                    <div className="parameter-description">ãƒ¡ãƒ­ãƒ‡ã‚£ãƒ¼ã®è¡¨ç¾åŠ›</div>
                                </div>
                            </div>
                        </div>

                        {/* ä½¿ç”¨æ–¹æ³• */}
                        <div className="section">
                            <h3 className="section-title">ğŸ“– ä½¿ç”¨æ–¹æ³•</h3>
                            <div className="info-container">
                                <p style={{marginBottom: '10px', lineHeight: '1.6'}}>
                                    1. <strong>AIå‰µé€ æ€§ãƒ¬ãƒ™ãƒ«</strong>ã‚’èª¿æ•´ã—ã¦ãã ã•ã„ï¼ˆé«˜ã„ã»ã©å®Ÿé¨“çš„ï¼‰
                                </p>
                                <p style={{marginBottom: '10px', lineHeight: '1.6'}}>
                                    2. <strong>AIä½œæ›²</strong>ãƒœã‚¿ãƒ³ã§æ–°ã—ã„éŸ³æ¥½ã‚’ç”Ÿæˆ
                                </p>
                                <p style={{marginBottom: '10px', lineHeight: '1.6'}}>
                                    3. <strong>å‰µé€ çš„ä½œæ›²</strong>ã§æœ€é«˜å‰µé€ æ€§ãƒ¬ãƒ™ãƒ«ã§ä½œæ›²
                                </p>
                                <p style={{marginBottom: '10px', lineHeight: '1.6'}}>
                                    4. <strong>å†ç”Ÿ</strong>ãƒœã‚¿ãƒ³ã§éŸ³æ¥½ã‚’æ¥½ã—ã‚€
                                </p>
                                <p style={{color: 'rgba(255,255,255,0.7)', fontSize: '12px', marginTop: '15px'}}>
                                    â€» å„æ¥½æ›²ã¯å®Œå…¨ã«AIã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ã€æ¯å›ç•°ãªã‚‹éŸ³æ¥½ãŒä½œã‚‰ã‚Œã¾ã™
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<AIBGMGenerator />, document.getElementById('root'));
    </script>
</body>
</html>